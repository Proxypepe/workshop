Argo CD наблюдает за репозиторием Git и сначала запускает шаблон Helm для создания Kubernetes YAML манифест и сравнивает их с желаемым состоянием в кластере, которое называется статусом синхронизации. Если Argo обнаружит какие-либо различия, файлы шаблонов будут применены с помощью «kubectl apply» и соответственно изменят желаемое состояние Kubernetes, что можно автоматизировать или выполнить вручную. Кроме того, Argo CD наблюдает за активными объектами Kubernetes и сравнивает их с желаемым состоянием Kubernetes, которое называется состоянием работоспособности приложения.
Приятным наблюдением является то, что Argo CD не использовал установку helm, а вместо этого применял стандартный kubectl. Причина этого в том, что Argo CD поддерживает множество инструментов шаблонов, и его обязанностью является развертывание желаемого состояния в качестве декларативного инструмента GitOps, не будучи оболочкой ни одного из этих инструментов.

 

Архитектурный обзор
Основной компонент Argo CD реализован как контроллер Kubernetes, поэтому, прежде чем углубляться в каждый компонент по отдельности, нам необходимо понять, как работает контроллер Kubernetes.
Контроллеры Kubernetes на практике наблюдают за состоянием кластера, а затем применяют или запрашивают изменения, если они необходимы. Таким образом, на практике контроллер будет стараться поддерживать текущее состояние кластера близким к желаемому. Контроллер наблюдает за объектом ресурса Kubernetes (по крайней мере, за одним), и у него есть поле спецификации, представляющее желаемое состояние.

Основные компоненты Argo CD
Argo CD представляет собой набор различных компонентов и инструментов. Основные компоненты Argo CD:
• Сервер API. Подобно Kubernetes, Argo CD имеет сервер API, который предоставляет API, с которыми могут взаимодействовать другие системы, например веб-интерфейс, интерфейс командной строки, события Argo и системы CI/CD. Сервер API отвечает за следующее:
1.	Управление приложениями и отчеты об их статусе.
2.	Запуск набора операций для приложений
3.	Управление репозиториями Git и кластерами Kubernetes.
4.	Поддержка аутентификации и единого входа
5.	Применение политики RBAC

•	Сервер репозитория. Основная ответственность сервера репозитория заключается в поддержании локального кеша репозитория Git, содержащего манифесты приложений. Другие службы Argo отправляют запросы на сервер репозитория, чтобы получить манифесты Kubernetes, основываясь на следующих входных данных:
1. URL-адрес репозитория
2. Git-версия
3. Путь приложения
4. Настройки, специфичные для шаблона: параметры и значения helm.yaml

• Контроллер приложений. Контроллер приложений постоянно наблюдает за текущим состоянием приложения и сравнивает его с желаемым состоянием в репозитории Git. Всякий раз, когда происходит отклонение и состояние не синхронизировано, контроллер попытается исправить это и сопоставить текущее состояние с желаемым. Одна из его последних обязанностей — выполнение любых определяемых пользователем перехватчиков для событий жизненного цикла приложения.

 
